(()=>{var t={721:t=>{var e=function(t){"use strict";var e,n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(t,e,n){t[e]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",s=o.asyncIterator||"@@asyncIterator",g=o.toStringTag||"@@toStringTag";function l(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var o=e&&e.prototype instanceof b?e:b,a=Object.create(o.prototype),s=new I(r||[]);return i(a,"_invoke",{value:L(t,n,s)}),a}function h(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var d="suspendedStart",u="suspendedYield",p="executing",m="completed",f={};function b(){}function S(){}function y(){}var v={};l(v,a,(function(){return this}));var E=Object.getPrototypeOf,w=E&&E(E(M([])));w&&w!==n&&r.call(w,a)&&(v=w);var k=y.prototype=b.prototype=Object.create(v);function x(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function C(t,e){function n(i,o,a,s){var g=h(t[i],t,o);if("throw"!==g.type){var l=g.arg,c=l.value;return c&&"object"==typeof c&&r.call(c,"__await")?e.resolve(c.__await).then((function(t){n("next",t,a,s)}),(function(t){n("throw",t,a,s)})):e.resolve(c).then((function(t){l.value=t,a(l)}),(function(t){return n("throw",t,a,s)}))}s(g.arg)}var o;i(this,"_invoke",{value:function(t,r){function i(){return new e((function(e,i){n(t,r,e,i)}))}return o=o?o.then(i,i):i()}})}function L(t,e,n){var r=d;return function(i,o){if(r===p)throw new Error("Generator is already running");if(r===m){if("throw"===i)throw o;return B()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=T(a,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===d)throw r=m,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var g=h(t,e,n);if("normal"===g.type){if(r=n.done?m:u,g.arg===f)continue;return{value:g.arg,done:n.done}}"throw"===g.type&&(r=m,n.method="throw",n.arg=g.arg)}}}function T(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,T(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),f;var o=h(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,f;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,f):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,f)}function F(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function j(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(F,this),this.reset(!0)}function M(t){if(t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:B}}function B(){return{value:e,done:!0}}return S.prototype=y,i(k,"constructor",{value:y,configurable:!0}),i(y,"constructor",{value:S,configurable:!0}),S.displayName=l(y,g,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===S||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,y):(t.__proto__=y,l(t,g,"GeneratorFunction")),t.prototype=Object.create(k),t},t.awrap=function(t){return{__await:t}},x(C.prototype),l(C.prototype,s,(function(){return this})),t.AsyncIterator=C,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new C(c(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(k),l(k,g,"Generator"),l(k,a,(function(){return this})),l(k,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},t.values=M,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return s.type="throw",s.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],s=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var g=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(g&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(g){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,f):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),f},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),j(n),f}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;j(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:M(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),f}},t}(t.exports);try{regeneratorRuntime=e}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}},5331:(t,e,n)=>{const r=n(6583),{devDependencies:i}=n(8721);t.exports={corePath:"undefined"!=typeof process&&"development"===process.env.FFMPEG_ENV?r("/node_modules/@ffmpeg/core/dist/ffmpeg-core.js"):`https://unpkg.com/@ffmpeg/core@${i["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`}},4066:(t,e,n)=>{const r=n(6583);t.exports=async t=>{let e=t;if(void 0===t)return new Uint8Array;if("string"==typeof t)if(/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t))e=atob(t.split(",")[1]).split("").map((t=>t.charCodeAt(0)));else{const n=await fetch(r(t));e=await n.arrayBuffer()}else(t instanceof File||t instanceof Blob)&&(e=await(n=t,new Promise(((t,e)=>{const r=new FileReader;r.onload=()=>{t(r.result)},r.onerror=({target:{error:{code:t}}})=>{e(Error(`File could not be read! Code=${t}`))},r.readAsArrayBuffer(n)}))));var n;return new Uint8Array(e)}},9822:(t,e,n)=>{const r=n(6583),{log:i}=n(2215),o=async(t,e)=>{i("info",`fetch ${t}`);const n=await(await fetch(t)).arrayBuffer();i("info",`${t} file size = ${n.byteLength} bytes`);const r=new Blob([n],{type:e}),o=URL.createObjectURL(r);return i("info",`${t} blob URL = ${o}`),o};t.exports=async({corePath:t})=>{if("string"!=typeof t)throw Error("corePath should be a string!");const e=r(t),n=await o(e,"application/javascript"),a=await o(e.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),s=await o(e.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return"undefined"==typeof createFFmpegCore?new Promise((t=>{const e=document.createElement("script"),r=()=>{e.removeEventListener("load",r),i("info","ffmpeg-core.js script loaded"),t({createFFmpegCore,corePath:n,wasmPath:a,workerPath:s})};e.src=n,e.type="text/javascript",e.addEventListener("load",r),document.getElementsByTagName("head")[0].appendChild(e)})):(i("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:n,wasmPath:a,workerPath:s}))}},1332:(t,e,n)=>{const r=n(5331),i=n(9822),o=n(4066);t.exports={defaultOptions:r,getCreateFFmpegCore:i,fetchFile:o}},7309:t=>{t.exports={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}}},1642:(t,e,n)=>{const{defaultArgs:r,baseOptions:i}=n(7309),{setLogging:o,setCustomLogger:a,log:s}=n(2215),g=n(2809),l=n(8923),{defaultOptions:c,getCreateFFmpegCore:h}=n(1332),{version:d}=n(8721),u=Error("ffmpeg.wasm is not ready, make sure you have completed load().");t.exports=(t={})=>{const{log:e,logger:n,progress:p,...m}={...i,...c,...t};let f=null,b=null,S=null,y=!1,v=p;const E=({type:t,message:e})=>{s(t,e),g(e,v),(t=>{"FFMPEG_END"===t&&null!==S&&(S(),S=null,y=!1)})(e)};return o(e),a(n),s("info",`use ffmpeg.wasm v${d}`),{setProgress:t=>{v=t},setLogger:t=>{a(t)},setLogging:o,load:async()=>{if(s("info","load ffmpeg-core"),null!==f)throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.");{s("info","loading ffmpeg-core");const{createFFmpegCore:t,corePath:e,workerPath:n,wasmPath:r}=await h(m);f=await t({mainScriptUrlOrBlob:e,printErr:t=>E({type:"fferr",message:t}),print:t=>E({type:"ffout",message:t}),locateFile:(t,e)=>{if("undefined"!=typeof window){if(void 0!==r&&t.endsWith("ffmpeg-core.wasm"))return r;if(void 0!==n&&t.endsWith("ffmpeg-core.worker.js"))return n}return e+t}}),b=f.cwrap("proxy_main","number",["number","number"]),s("info","ffmpeg-core loaded")}},isLoaded:()=>null!==f,run:(...t)=>{if(s("info",`run ffmpeg command: ${t.join(" ")}`),null===f)throw u;if(y)throw Error("ffmpeg.wasm can only run one command at a time");return y=!0,new Promise((e=>{const n=[...r,...t].filter((t=>0!==t.length));S=e,b(...l(f,n))}))},FS:(t,...e)=>{if(s("info",`run FS.${t} ${e.map((t=>"string"==typeof t?t:`<${t.length} bytes binary file>`)).join(" ")}`),null===f)throw u;{let n=null;try{n=f.FS[t](...e)}catch(n){throw"readdir"===t?Error(`ffmpeg.FS('readdir', '${e[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`):"readFile"===t?Error(`ffmpeg.FS('readFile', '${e[0]}') error. Check if the path exists`):Error("Oops, something went wrong in FS operation.")}return n}}}}},8375:(t,e,n)=>{n(721);const r=n(1642),{fetchFile:i}=n(1332);t.exports={createFFmpeg:r,fetchFile:i}},2215:t=>{let e=!1,n=()=>{};t.exports={logging:e,setLogging:t=>{e=t},setCustomLogger:t=>{n=t},log:(t,e)=>{n({type:t,message:e})}}},8923:t=>{t.exports=(t,e)=>{const n=t._malloc(e.length*Uint32Array.BYTES_PER_ELEMENT);return e.forEach(((e,r)=>{const i=t._malloc(e.length+1);t.writeAsciiToMemory(e,i),t.setValue(n+Uint32Array.BYTES_PER_ELEMENT*r,i,"i32")})),[e.length,n]}},2809:t=>{let e=0,n=0;const r=t=>{const[e,n,r]=t.split(":");return 60*parseFloat(e)*60+60*parseFloat(n)+parseFloat(r)};t.exports=(t,i)=>{if("string"==typeof t)if(t.startsWith("  Duration")){const o=t.split(", ")[0].split(": ")[1],a=r(o);i({duration:a,ratio:n}),(0===e||e>a)&&(e=a)}else if(t.startsWith("frame")||t.startsWith("size")){const o=t.split("time=")[1].split(" ")[0],a=r(o);n=a/e,i({ratio:n,time:a})}else t.startsWith("video:")&&(i({ratio:1}),e=0)}},6583:function(t,e,n){var r,i;r=function(){return function(){var t=arguments.length;if(0===t)throw new Error("resolveUrl requires at least one argument; got none.");var e=document.createElement("base");if(e.href=arguments[0],1===t)return e.href;var n=document.getElementsByTagName("head")[0];n.insertBefore(e,n.firstChild);for(var r,i=document.createElement("a"),o=1;o<t;o++)i.href=arguments[o],r=i.href,e.href=r;return n.removeChild(e),r}},void 0===(i=r.call(e,n,e,t))||(t.exports=i)},8721:t=>{"use strict";t.exports=JSON.parse('{"name":"@ffmpeg/ffmpeg","version":"0.9.8","description":"FFmpeg WebAssembly version","main":"src/index.js","types":"src/index.d.ts","directories":{"example":"examples"},"scripts":{"start":"node scripts/server.js","build":"rimraf dist && webpack --config scripts/webpack.config.prod.js","prepublishOnly":"npm run build","lint":"eslint src","wait":"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js","test":"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node --experimental-wasm-threads --experimental-wasm-bulk-memory node_modules/.bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},"browser":{"./src/node/index.js":"./src/browser/index.js"},"repository":{"type":"git","url":"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},"keywords":["ffmpeg","WebAssembly","video"],"author":"Jerome Wu <jeromewus@gmail.com>","license":"MIT","bugs":{"url":"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},"engines":{"node":">=12.16.1"},"homepage":"https://github.com/ffmpegwasm/ffmpeg.wasm#readme","dependencies":{"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},"devDependencies":{"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.9.0","@types/emscripten":"^1.39.4","babel-loader":"^8.1.0","chai":"^4.2.0","cors":"^2.8.5","eslint":"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1","express":"^4.17.1","mocha":"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0","webpack":"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"}}')}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var o=e[r]={exports:{}};return t[r].call(o.exports,o,o.exports,n),o.exports}n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&(!t||!/^http(s?):/.test(t));)t=r[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),(()=>{"use strict";var t=n(8375);const e=n.p+"7a47064df6fad473253a.svg";var r=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{g(r.next(t))}catch(t){o(t)}}function s(t){try{g(r.throw(t))}catch(t){o(t)}}function g(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}g((r=r.apply(t,e||[])).next())}))};class i{constructor(){this.TIMER=5,this.init=()=>{this.getUserAccount(),this.addTabSegmentListeners(),this.addBackButtonListener()},this.addClosePopupListener=()=>{document.getElementById("close-tab-chunk-container-icon").addEventListener("click",(()=>{document.getElementById("popup-modal").style.display="none"}))},this.addMarkers=()=>{const t=i.videoDuration,e=document.querySelector(".markers"),n=this.getVideoTime(i.tabChunks.highEString),r=[],o=[];n.forEach((t=>{r.push(t.start),o.push(t.end)})),e.innerHTML="",r.forEach(((n,r)=>{const i=document.createElement("div");i.classList.add("marker");const a=n/t*100,s=o[r]/t*100;i.style.left=`${a}%`,i.style.width=s-a+"%",i.style.backgroundColor=`${this.tabClipSegmentColors[r]}`,i.style.opacity=".5",e.appendChild(i)}))},this.getVideoText=t=>{const e=[];return t.forEach((t=>{e.push(t.text)})),e},this.getVideoTime=t=>{const e=[];return t.forEach((t=>{e.push(t.time)})),e},this.buildTabChunkHTML=()=>{const t=document.createElement("div");t.classList.add("tab-chunk-container");for(let e=0;e<Object.keys(i.tabChunks.highEString).length;e++){const n=document.createElement("div");n.id="tab-chunk-"+i.tabChunks.highEString[e].id,n.classList.add("tab-chunk-text");const r=document.createElement("p");r.innerHTML=i.tabChunks.highEString[e].text,n.append(r);const o=document.createElement("p");o.innerHTML=i.tabChunks.bString[e].text,n.append(o);const a=document.createElement("p");a.innerHTML=i.tabChunks.gString[e].text,n.append(a);const s=document.createElement("p");s.innerHTML=i.tabChunks.dString[e].text,n.append(s);const g=document.createElement("p");g.innerHTML=i.tabChunks.aString[e].text,n.append(g);const l=document.createElement("p");l.innerHTML=i.tabChunks.eString[e].text,n.append(l),n.style.backgroundColor=this.tabClipSegmentColors[e],n.setAttribute("color",this.tabClipSegmentColors[e]),t.append(n)}const e=document.createElement("i");return e.classList.add("fas"),e.classList.add("fa-angle-down"),e.id="close-tab-chunk-container-icon",t.prepend(e),t.outerHTML},this.adjustTabChunkTime=t=>{const e=t.id.split("-")[2];i.selectedTabChunkId=e},this.addBackButtonListener=()=>{document.getElementById("return-to-tab-button").addEventListener("click",(()=>{window.location.href="create.html?username="+this.user.username+"&title="+this.tabTitle}))},this.addTabSegmentListeners=()=>{const t=document.getElementById("start-tab-segment-button"),e=document.getElementById("end-tab-segment-button"),n=document.getElementById("video-timeline");t.addEventListener("click",(()=>{t.style.backgroundColor="#23FE69",setTimeout((()=>{t.style.backgroundColor="rgb(29, 29, 31, .75)"}),1e3);for(let t=0;t<Object.keys(i.tabChunks.highEString).length;t++)i.tabChunks.highEString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.highEString[t].time.start=Math.round(Number(n.value)*i.videoDuration/100)),i.tabChunks.bString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.bString[t].time.start=Math.round(Number(n.value)*i.videoDuration/100)),i.tabChunks.gString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.gString[t].time.start=Math.round(Number(n.value)*i.videoDuration/100)),i.tabChunks.dString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.dString[t].time.start=Math.round(Number(n.value)*i.videoDuration/100)),i.tabChunks.aString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.aString[t].time.start=Math.round(Number(n.value)*i.videoDuration/100)),i.tabChunks.eString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.eString[t].time.start=Math.round(Number(n.value)*i.videoDuration/100));this.addMarkers(),this.initVideoUpload()})),e.addEventListener("click",(()=>{e.style.backgroundColor="#23FE69",setTimeout((()=>{e.style.backgroundColor="rgb(29, 29, 31, .75)"}),1e3);for(let t=0;t<Object.keys(i.tabChunks.highEString).length;t++)i.tabChunks.highEString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.highEString[t].time.end=Math.round(Number(n.value)*i.videoDuration/100)),i.tabChunks.bString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.bString[t].time.end=Math.round(Number(n.value)*i.videoDuration/100)),i.tabChunks.gString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.gString[t].time.end=Math.round(Number(n.value)*i.videoDuration/100)),i.tabChunks.dString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.dString[t].time.end=Math.round(Number(n.value)*i.videoDuration/100)),i.tabChunks.aString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.aString[t].time.end=Math.round(Number(n.value)*i.videoDuration/100)),i.tabChunks.eString[t].id===Number(i.selectedTabChunkId)&&(i.tabChunks.eString[t].time.end=Math.round(Number(n.value)*i.videoDuration/100));this.addMarkers(),this.initVideoUpload()}))},this.saveVideo=(e,n)=>{const i=document.getElementById("start-record"),o=document.createElement("video"),a=document.getElementById("video-canvas"),s=a.getContext("2d");let g=["","","","","",""];o.style.display="none";const l=URL.createObjectURL(e);o.src=l;let c,h,d=[],u=!1;function p(){return r(this,void 0,void 0,(function*(){if(u){if(s.clearRect(0,0,a.width,a.height),s.drawImage(o,0,0,a.width,a.height),s.font="48px Monospace",s.fillStyle="white",s.strokeStyle="white",s.lineWidth=2,s.textAlign="left",g.forEach(((t,e)=>{if(t){const n=50,r=a.height-50*(6-e)-100;s.fillText(t,n,r),s.strokeText(t,n,r)}})),o.currentTime>=o.duration)return c.stop(),void(u=!1);requestAnimationFrame(p)}}))}function m(){return r(this,void 0,void 0,(function*(){const e=new Blob(d,{type:"video/webm"}),r=URL.createObjectURL(e),i=document.createElement("a");i.style.display="none",i.href=r,i.download=n+".webm",document.body.appendChild(i),i.click();const o=(0,t.createFFmpeg)({log:!0});yield o.load(),o.FS("writeFile","input.webm",new Uint8Array(yield e.arrayBuffer())),yield o.run("-i","input.webm","-c:v","libx264","-preset","fast","-crf","23","output.mp4");const a=o.FS("readFile","output.mp4"),s=new Blob([a.buffer],{type:"video/mp4"}),g=URL.createObjectURL(s),l=document.createElement("a");l.href=g,l.download=n+".mp4",document.body.appendChild(l),l.click(),URL.revokeObjectURL(g),URL.revokeObjectURL(r),d=[],u=!1,document.getElementById("loading-modal").style.display="none"}))}i.addEventListener("click",(function(){return r(this,void 0,void 0,(function*(){document.getElementById("loading-modal").style.display="flex",u||(d=[],h=a.captureStream(30),c=new MediaRecorder(h,{mimeType:"video/webm; codecs=vp9"}),c.ondataavailable=t=>{t.data&&t.data.size>0&&d.push(t.data)},c.onstop=m,c.start(),u=!0,o.play(),p())}))}))},this.initVideoUpload=()=>{const t=document.getElementById("video-icon"),n=document.getElementById("video-editing-tool-container"),r=document.getElementById("video-upload"),o=document.getElementById("video-canvas"),a=o.getContext("2d"),s=document.createElement("video"),g=document.getElementById("video-timeline"),l=document.getElementById("pause-icon"),c=document.getElementById("view-tab-chunks-button");t.src=e;const h=this.getVideoText(i.tab.highEString),d=this.getVideoText(i.tab.bString),u=this.getVideoText(i.tab.gString),p=this.getVideoText(i.tab.dString),m=this.getVideoText(i.tab.aString),f=this.getVideoText(i.tab.eString),b=this.getVideoTime(i.tabChunks.highEString),S=this.getVideoTime(i.tabChunks.bString),y=this.getVideoTime(i.tabChunks.gString),v=this.getVideoTime(i.tabChunks.dString),E=this.getVideoTime(i.tabChunks.aString),w=this.getVideoTime(i.tabChunks.eString);let k=["","","","","",""];function x(t,e,n){const r=s.currentTime;k[n]="",e.forEach(((e,i)=>{r>=e.start&&r<e.end&&(k[n]=t[i])}))}function C(){s.paused||s.ended||(a.clearRect(0,0,o.width,o.height),a.drawImage(s,0,0,o.width,o.height),a.font="48px Monospace",a.fillStyle="white",a.strokeStyle="white",a.lineWidth=2,a.textAlign="left",k.forEach(((t,e)=>{if(t){const n=50,r=o.height-50*(6-e)-100;a.fillText(t,n,r),a.strokeText(t,n,r)}})),requestAnimationFrame(C))}r.addEventListener("change",(t=>{var r;const g=document.getElementById("upload-video-buttons-container"),l=document.getElementById("video-canvas"),h=document.getElementById("video-icon");h.style.display="none",g.style.display="none",l.style.display="block";const d=null===(r=t.target.files)||void 0===r?void 0:r[0];if(d){this.saveVideo(d,this.tabTitle),n.style.display="block";const t=document.getElementById("unmount-video-button");t.style.display="block",c.addEventListener("click",(()=>{c.style.backgroundColor="#23FE69",setTimeout((()=>{c.style.backgroundColor="rgb(29, 29, 31, .75)"}),500);const t=document.getElementById("popup-modal");t.innerHTML=this.buildTabChunkHTML(),this.addClosePopupListener();const e=document.getElementsByClassName("tab-chunk-text");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(n=>{const r=document.getElementById("selected-tab-indicator");for(let t=0;t<e.length;t++)e[t].classList.remove("tab-segment-selected");r.style.backgroundColor=e[t].getAttribute("color"),r.innerHTML="Clip "+(t+1),this.adjustTabChunkTime(e[t]),e[t].classList.add("tab-segment-selected")}));t.style.display="flex"})),t.addEventListener("click",(()=>{null!=s&&(s.pause(),s.removeAttribute("src"),s.load(),a.clearRect(0,0,o.width,o.height),n.style.display="none",l.style.display="none",g.style.display="flex",h.style.display="block",h.src=e)}));const r=URL.createObjectURL(d);s.src=r,s.load(),s.play(),s.muted=!1,s.addEventListener("loadedmetadata",(()=>{i.videoDuration=Number(s.duration.toFixed(0)),o.width=s.videoWidth,o.height=s.videoHeight,this.TIMER=Math.round(i.tabChunks.highEString.length*i.videoDuration/100),this.addMarkers(),requestAnimationFrame(C)}))}})),n.addEventListener("click",(()=>{s.src&&(s.paused?(requestAnimationFrame(C),s.play(),l.style.display="none"):(s.pause(),l.style.display="flex"))})),g.addEventListener("change",(()=>{C()})),g.addEventListener("input",(()=>{const t=Number(g.value)/100*s.duration;Number.isNaN(t)||(s.currentTime=t,a.clearRect(0,0,o.width,o.height),a.drawImage(s,0,0,o.width,o.height),s.pause(),l.style.display="flex")})),s.addEventListener("timeupdate",(()=>{const t=s.currentTime/s.duration*100;g.value=t.toString(),x(h,b,0),x(d,S,1),x(u,y,2),x(p,v,3),x(m,E,4),x(f,w,5)}))},this.getUserAccount=()=>r(this,void 0,void 0,(function*(){const t=window.location.search,e=new URLSearchParams(t),n=e.get("username"),r=yield fetch("https://guitar-tablature-to-pdf-147ddb720da0.herokuapp.com/getUserAccount?username="+n),o=yield r.json(),a=e.get("title");this.tabTitle=a,this.user=o;const s=this.user.tabs.find((t=>t.tabTitle===a));i.tab=this.splitTabIntoChunks(this.formatTabForPDFExport(s.tabData)),i.tabChunks=this.splitTabIntoChunks(this.formatTabForPDFExport(s.tabData)),this.initVideoUpload()})),this.splitTabIntoChunks=t=>{const e=t.highEString.split(""),n=t.bString.split(""),r=t.gString.split(""),i=t.dString.split(""),o=t.aString.split(""),a=t.eString.split(""),s=[],g=[],l=[],c=[],h=[],d=[],u={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};let p=33,m=this.TIMER;for(let t=0;t<e.length;t++)s.push(e[t]),g.push(n[t]),l.push(r[t]),c.push(i[t]),h.push(o[t]),d.push(a[t]),t!==p&&t!==e.length-1||(u.highEString.push({text:s.join(""),id:t,time:{start:m,end:m+this.TIMER}}),u.bString.push({text:g.join(""),id:t,time:{start:m,end:m+this.TIMER}}),u.gString.push({text:l.join(""),id:t,time:{start:m,end:m+this.TIMER}}),u.dString.push({text:c.join(""),id:t,time:{start:m,end:m+this.TIMER}}),u.aString.push({text:h.join(""),id:t,time:{start:m,end:m+this.TIMER}}),u.eString.push({text:d.join(""),id:t,time:{start:m,end:m+this.TIMER}}),p+=33,m+=this.TIMER,s.splice(0,t),g.splice(0,t),l.splice(0,t),c.splice(0,t),h.splice(0,t),d.splice(0,t));return u},this.formatTabForPDFExport=t=>{const e=this.findLongestString(t),n={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};let r,i,o,a,s,g;"string"==typeof t.highEString?(r=t.highEString.split(""),i=t.bString.split(""),o=t.gString.split(""),a=t.dString.split(""),s=t.aString.split(""),g=t.eString.split("")):(r=t.highEString,i=t.bString,o=t.gString,a=t.dString,s=t.aString,g=t.eString);const l=Math.max(r.length,i.length,o.length,a.length,s.length,g.length);for(let e=0;e<l;e++)void 0===t.highEString[e]&&(t.highEString+="-"),void 0===t.bString[e]&&(t.bString+="-"),void 0===t.gString[e]&&(t.gString+="-"),void 0===t.dString[e]&&(t.dString+="-"),void 0===t.aString[e]&&(t.aString+="-"),void 0===t.eString[e]&&(t.eString+="-");for(let r=0;r<e;r++){const e=t.highEString[r],i=t.bString[r],o=t.gString[r],a=t.dString[r],s=t.aString[r],g=t.eString[r],l=t.highEString[r-1],c=t.bString[r-1],h=t.gString[r-1],d=t.dString[r-1],u=t.aString[r-1],p=t.eString[r-1],m=t.highEString[r+1],f=t.bString[r+1],b=t.gString[r+1],S=t.dString[r+1],y=t.aString[r+1],v=t.eString[r+1];"{"!==e&&(n.highEString.push(e),"{"!==l&&"}"!==m&&"}"!==e&&n.highEString.push("-")),"{"!==i&&(n.bString.push(i),"{"!==c&&"}"!==f&&"}"!==i&&n.bString.push("-")),"{"!==o&&(n.gString.push(o),"{"!==h&&"}"!==b&&"}"!==o&&n.gString.push("-")),"{"!==a&&(n.dString.push(a),"{"!==d&&"}"!==S&&"}"!==a&&n.dString.push("-")),"{"!==s&&(n.aString.push(s),"{"!==u&&"}"!==y&&"}"!==s&&n.aString.push("-")),"{"!==g&&(n.eString.push(g),"{"!==p&&"}"!==v&&"}"!==g&&n.eString.push("-"))}const c=n.highEString.join("").split(""),h=n.bString.join("").split(""),d=n.gString.join("").split(""),u=n.dString.join("").split(""),p=n.aString.join("").split(""),m=n.eString.join("").split(""),f=Math.max(c.length,h.length,d.length,u.length,p.length,m.length);let b={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};for(let t=0;t<f;t++)b.highEString.push(n.highEString[t]||"-"),b.bString.push(n.bString[t]||"-"),b.gString.push(n.gString[t]||"-"),b.dString.push(n.dString[t]||"-"),b.aString.push(n.aString[t]||"-"),b.eString.push(n.eString[t]||"-");b={highEString:b.highEString,bString:b.bString,gString:b.gString,dString:b.dString,aString:b.aString,eString:b.eString};let S=0;for(let t=0;t<b.highEString.length;t++){const e=b.highEString[t]||"-",n=b.bString[t]||"-",r=b.gString[t]||"-",i=b.dString[t]||"-",o=b.aString[t]||"-",a=b.eString[t]||"-";"-"===e&&"-"===n&&"-"===r&&"-"===i&&"-"===o&&"-"===a||(S=t),"}"===e&&(b.highEString[t]="-"),"}"===n&&(b.bString[t]="-"),"}"===r&&(b.gString[t]="-"),"}"===i&&(b.dString[t]="-"),"}"===o&&(b.aString[t]="-"),"}"===a&&(b.eString[t]="-"),"}"!==e&&"}"!==n&&"}"!==r&&"}"!==i&&"}"!==o&&"}"!==a||("}"===e?b.highEString[t]="-":b.highEString.splice(t,0,"-"),"}"===n?b.bString[t]="-":b.bString.splice(t,0,"-"),"}"===r?b.gString[t]="-":b.gString.splice(t,0,"-"),"}"===i?b.dString[t]="-":b.dString.splice(t,0,"-"),"}"===o?b.aString[t]="-":b.aString.splice(t,0,"-"),"}"===a?b.eString[t]="-":b.eString.splice(t,0,"-"))}const y={highEString:b.highEString.slice(0,S+4).join(""),bString:b.bString.slice(0,S+4).join(""),gString:b.gString.slice(0,S+4).join(""),dString:b.dString.slice(0,S+4).join(""),aString:b.aString.slice(0,S+4).join(""),eString:b.eString.slice(0,S+4).join("")},v=document.getElementById("tab-text-highEString"),E=document.getElementById("tab-text-bString"),w=document.getElementById("tab-text-gString"),k=document.getElementById("tab-text-dString"),x=document.getElementById("tab-text-aString"),C=document.getElementById("tab-text-eString");return v.innerHTML=b.highEString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),E.innerHTML=b.bString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),w.innerHTML=b.gString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),k.innerHTML=b.dString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),x.innerHTML=b.aString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),C.innerHTML=b.eString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),y},this.findLongestString=t=>{const e={stringName:"",stringLength:0};return Object.entries(t).forEach((t=>{const n=t[0],r=t[1].length;r>e.stringLength&&(e.stringName=n,e.stringLength=r)})),e.stringLength},this.user={},this.tabTitle="",this.tabClipSegmentColors=["#23FE69","#FF1493","#00FFFF","#9400D3","#FDFD00","#FF073A","#FDFD00"]}}(new i).init()})()})();