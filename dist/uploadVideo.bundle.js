(()=>{"use strict";class t{constructor(){this.init=()=>{this.getUserAccount()},this.getVideoText=t=>{const i=[];return t.forEach((t=>{i.push(t.text)})),i},this.getVideoTime=t=>{const i=[];return t.forEach((t=>{i.push(t.time)})),i},this.initVideoUpload=()=>{const i=document.getElementById("video-upload"),n=document.getElementById("video-canvas"),g=n.getContext("2d"),e=document.createElement("video"),r=this.getVideoText(t.tab.highEString),h=this.getVideoText(t.tab.bString),S=this.getVideoText(t.tab.gString),s=this.getVideoText(t.tab.dString),l=this.getVideoText(t.tab.aString),o=this.getVideoText(t.tab.eString),a=this.getVideoTime(t.tab.highEString),d=this.getVideoTime(t.tab.bString),c=this.getVideoTime(t.tab.gString),p=this.getVideoTime(t.tab.dString),u=this.getVideoTime(t.tab.aString),b=this.getVideoTime(t.tab.eString);let m=["","","","","",""];function E(t,i,n){const g=e.currentTime;m[n]="",i.forEach(((i,e)=>{g>=i.start&&g<i.end&&(m[n]=t[e])}))}function f(){e.paused||e.ended||(g.drawImage(e,0,0,n.width,n.height),g.font="48px Monospace",g.fillStyle="white",g.strokeStyle="white",g.lineWidth=2,g.textAlign="left",m.forEach(((t,i)=>{if(t){const e=50,r=n.height-50*(6-i);g.fillText(t,e,r),g.strokeText(t,e,r)}})),requestAnimationFrame(f))}i.addEventListener("change",(t=>{var i;document.getElementById("upload-video-buttons-container").style.display="none";const g=null===(i=t.target.files)||void 0===i?void 0:i[0];if(g){const t=URL.createObjectURL(g);e.src=t,e.load(),e.play(),e.muted=!0,e.addEventListener("loadedmetadata",(()=>{n.width=e.videoWidth,n.height=e.videoHeight,requestAnimationFrame(f)}))}})),e.addEventListener("timeupdate",(()=>{E(r,a,0),E(h,d,1),E(S,c,2),E(s,p,3),E(l,u,4),E(o,b,5)}))},this.getUserAccount=()=>{return i=this,g=function*(){const i=window.location.search,n=new URLSearchParams(i),g=n.get("username"),e=yield fetch("https://guitar-tablature-to-pdf-147ddb720da0.herokuapp.com/getUserAccount?username="+g),r=yield e.json(),h=n.get("title");this.tabTitle=h,this.user=r;const S=this.user.tabs.find((t=>t.tabTitle===h));t.tab=this.splitTabIntoChunks(this.formatTabForPDFExport(S.tabData)),this.initVideoUpload()},new((n=void 0)||(n=Promise))((function(t,e){function r(t){try{S(g.next(t))}catch(t){e(t)}}function h(t){try{S(g.throw(t))}catch(t){e(t)}}function S(i){var g;i.done?t(i.value):(g=i.value,g instanceof n?g:new n((function(t){t(g)}))).then(r,h)}S((g=g.apply(i,[])).next())}));var i,n,g},this.splitTabIntoChunks=t=>{const i=t.highEString.split(""),n=t.bString.split(""),g=t.gString.split(""),e=t.dString.split(""),r=t.aString.split(""),h=t.eString.split(""),S=[],s=[],l=[],o=[],a=[],d=[],c={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};let p=33,u=5;for(let t=0;t<i.length;t++)S.push(i[t]),s.push(n[t]),l.push(g[t]),o.push(e[t]),a.push(r[t]),d.push(h[t]),t===p&&(c.highEString.push({text:S.join(""),time:{start:u,end:u+u}}),c.bString.push({text:s.join(""),time:{start:u,end:u+u}}),c.gString.push({text:l.join(""),time:{start:u,end:u+u}}),c.dString.push({text:o.join(""),time:{start:u,end:u+u}}),c.aString.push({text:a.join(""),time:{start:u,end:u+u}}),c.eString.push({text:d.join(""),time:{start:u,end:u+u}}),p+=p,u+=u,S.splice(0,t),s.splice(0,t),l.splice(0,t),o.splice(0,t),a.splice(0,t),d.splice(0,t));return c},this.formatTabForPDFExport=t=>{const i=this.findLongestString(t),n={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};let g,e,r,h,S,s;"string"==typeof t.highEString?(g=t.highEString.split(""),e=t.bString.split(""),r=t.gString.split(""),h=t.dString.split(""),S=t.aString.split(""),s=t.eString.split("")):(g=t.highEString,e=t.bString,r=t.gString,h=t.dString,S=t.aString,s=t.eString);const l=Math.max(g.length,e.length,r.length,h.length,S.length,s.length);for(let i=0;i<l;i++)void 0===t.highEString[i]&&(t.highEString+="-"),void 0===t.bString[i]&&(t.bString+="-"),void 0===t.gString[i]&&(t.gString+="-"),void 0===t.dString[i]&&(t.dString+="-"),void 0===t.aString[i]&&(t.aString+="-"),void 0===t.eString[i]&&(t.eString+="-");for(let g=0;g<i;g++){const i=t.highEString[g],e=t.bString[g],r=t.gString[g],h=t.dString[g],S=t.aString[g],s=t.eString[g],l=t.highEString[g-1],o=t.bString[g-1],a=t.gString[g-1],d=t.dString[g-1],c=t.aString[g-1],p=t.eString[g-1],u=t.highEString[g+1],b=t.bString[g+1],m=t.gString[g+1],E=t.dString[g+1],f=t.aString[g+1],x=t.eString[g+1];"{"!==i&&(n.highEString.push(i),"{"!==l&&"}"!==u&&"}"!==i&&n.highEString.push("-")),"{"!==e&&(n.bString.push(e),"{"!==o&&"}"!==b&&"}"!==e&&n.bString.push("-")),"{"!==r&&(n.gString.push(r),"{"!==a&&"}"!==m&&"}"!==r&&n.gString.push("-")),"{"!==h&&(n.dString.push(h),"{"!==d&&"}"!==E&&"}"!==h&&n.dString.push("-")),"{"!==S&&(n.aString.push(S),"{"!==c&&"}"!==f&&"}"!==S&&n.aString.push("-")),"{"!==s&&(n.eString.push(s),"{"!==p&&"}"!==x&&"}"!==s&&n.eString.push("-"))}const o=n.highEString.join("").split(""),a=n.bString.join("").split(""),d=n.gString.join("").split(""),c=n.dString.join("").split(""),p=n.aString.join("").split(""),u=n.eString.join("").split(""),b=Math.max(o.length,a.length,d.length,c.length,p.length,u.length);let m={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};for(let t=0;t<b;t++)m.highEString.push(n.highEString[t]||"-"),m.bString.push(n.bString[t]||"-"),m.gString.push(n.gString[t]||"-"),m.dString.push(n.dString[t]||"-"),m.aString.push(n.aString[t]||"-"),m.eString.push(n.eString[t]||"-");m={highEString:m.highEString,bString:m.bString,gString:m.gString,dString:m.dString,aString:m.aString,eString:m.eString};let E=0;for(let t=0;t<m.highEString.length;t++){const i=m.highEString[t]||"-",n=m.bString[t]||"-",g=m.gString[t]||"-",e=m.dString[t]||"-",r=m.aString[t]||"-",h=m.eString[t]||"-";"-"===i&&"-"===n&&"-"===g&&"-"===e&&"-"===r&&"-"===h||(E=t),"}"===i&&(m.highEString[t]="-"),"}"===n&&(m.bString[t]="-"),"}"===g&&(m.gString[t]="-"),"}"===e&&(m.dString[t]="-"),"}"===r&&(m.aString[t]="-"),"}"===h&&(m.eString[t]="-"),"}"!==i&&"}"!==n&&"}"!==g&&"}"!==e&&"}"!==r&&"}"!==h||("}"===i?m.highEString[t]="-":m.highEString.splice(t,0,"-"),"}"===n?m.bString[t]="-":m.bString.splice(t,0,"-"),"}"===g?m.gString[t]="-":m.gString.splice(t,0,"-"),"}"===e?m.dString[t]="-":m.dString.splice(t,0,"-"),"}"===r?m.aString[t]="-":m.aString.splice(t,0,"-"),"}"===h?m.eString[t]="-":m.eString.splice(t,0,"-"))}const f={highEString:m.highEString.slice(0,E+4).join(""),bString:m.bString.slice(0,E+4).join(""),gString:m.gString.slice(0,E+4).join(""),dString:m.dString.slice(0,E+4).join(""),aString:m.aString.slice(0,E+4).join(""),eString:m.eString.slice(0,E+4).join("")},x=document.getElementById("tab-text-highEString"),T=document.getElementById("tab-text-bString"),j=document.getElementById("tab-text-gString"),v=document.getElementById("tab-text-dString"),y=document.getElementById("tab-text-aString"),L=document.getElementById("tab-text-eString");return x.innerHTML=m.highEString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),T.innerHTML=m.bString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),j.innerHTML=m.gString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),v.innerHTML=m.dString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),y.innerHTML=m.aString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),L.innerHTML=m.eString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),f},this.findLongestString=t=>{const i={stringName:"",stringLength:0};return Object.entries(t).forEach((t=>{const n=t[0],g=t[1].length;g>i.stringLength&&(i.stringName=n,i.stringLength=g)})),i.stringLength},this.user={},this.tabTitle=""}}(new t).init()})();