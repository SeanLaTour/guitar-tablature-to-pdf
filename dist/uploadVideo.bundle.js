(()=>{"use strict";class t{constructor(){this.TIMER=3,this.init=()=>{this.getUserAccount()},this.getVideoText=t=>{const i=[];return t.forEach((t=>{i.push(t.text)})),i},this.getVideoTime=t=>{const i=[];return t.forEach((t=>{i.push(t.time)})),i},this.buildTabChunkHTML=()=>{let i="";return t.tabChunks.highEString.forEach((t=>{const n=document.createElement("div");n.classList.add("tab-chunk-text"),n.innerHTML=t.text,i+=n.outerHTML})),t.tabChunks.bString.forEach((t=>{const n=document.createElement("div");n.classList.add("tab-chunk-text"),n.innerHTML=t.text,i+=n.outerHTML})),t.tabChunks.gString.forEach((t=>{const n=document.createElement("div");n.classList.add("tab-chunk-text"),n.innerHTML=t.text,i+=n.outerHTML})),t.tabChunks.dString.forEach((t=>{const n=document.createElement("div");n.classList.add("tab-chunk-text"),n.innerHTML=t.text,i+=n.outerHTML})),t.tabChunks.aString.forEach((t=>{const n=document.createElement("div");n.classList.add("tab-chunk-text"),n.innerHTML=t.text,i+=n.outerHTML})),t.tabChunks.eString.forEach((t=>{const n=document.createElement("div");n.classList.add("tab-chunk-text"),n.innerHTML=t.text,i+=n.outerHTML})),i},this.initVideoUpload=()=>{const i=document.getElementById("video-editing-tool-container"),n=document.getElementById("video-upload"),e=document.getElementById("video-canvas"),g=e.getContext("2d"),r=document.createElement("video"),h=document.getElementById("video-timeline"),s=document.getElementById("pause-icon"),a=document.getElementById("view-tab-chunks-button"),S=this.getVideoText(t.tab.highEString),l=this.getVideoText(t.tab.bString),o=this.getVideoText(t.tab.gString),d=this.getVideoText(t.tab.dString),c=this.getVideoText(t.tab.aString),u=this.getVideoText(t.tab.eString),p=this.getVideoTime(t.tab.highEString),m=this.getVideoTime(t.tab.bString),b=this.getVideoTime(t.tab.gString),E=this.getVideoTime(t.tab.dString),T=this.getVideoTime(t.tab.aString),y=this.getVideoTime(t.tab.eString);let x=["","","","","",""];function f(t,i,n){const e=r.currentTime;x[n]="",i.forEach(((i,g)=>{e>=i.start&&e<i.end&&(x[n]=t[g])}))}function v(){r.paused||r.ended||(g.drawImage(r,0,0,e.width,e.height),g.font="48px Monospace",g.fillStyle="white",g.strokeStyle="white",g.lineWidth=2,g.textAlign="left",x.forEach(((t,i)=>{if(t){const n=50,r=e.height-50*(6-i)-100;g.fillText(t,n,r),g.strokeText(t,n,r)}})),requestAnimationFrame(v))}n.addEventListener("change",(t=>{var n;const h=document.getElementById("upload-video-buttons-container"),s=document.getElementById("video-canvas"),S=document.getElementById("video-icon");S.style.display="none",h.style.display="none",s.style.display="block";const l=null===(n=t.target.files)||void 0===n?void 0:n[0];if(l){i.style.display="block";const t=document.getElementById("unmount-video-button");t.style.display="block";let n=!1;a.addEventListener("click",(()=>{const t=document.getElementById("popup-modal");t.innerHTML=this.buildTabChunkHTML(),n?(t.style.display="none",n=!1):(t.style.display="flex",n=!0)})),t.addEventListener("click",(()=>{null!=r&&(r.pause(),r.removeAttribute("src"),r.load(),g.clearRect(0,0,e.width,e.height),i.style.display="none",s.style.display="none",h.style.display="flex",S.style.display="block")}));const o=URL.createObjectURL(l);r.src=o,r.load(),r.play(),r.muted=!0,r.addEventListener("loadedmetadata",(()=>{e.width=r.videoWidth,e.height=r.videoHeight,requestAnimationFrame(v)}))}})),i.addEventListener("click",(()=>{r.src&&(r.paused?(requestAnimationFrame(v),r.play(),s.style.display="none"):(r.pause(),s.style.display="flex"))})),h.addEventListener("change",(()=>{v()})),h.addEventListener("input",(()=>{const t=Number(h.value)/100*r.duration;r.currentTime=t,g.clearRect(0,0,e.width,e.height),g.drawImage(r,0,0,e.width,e.height),r.pause(),s.style.display="flex"})),r.addEventListener("timeupdate",(()=>{const t=r.currentTime/r.duration*100;h.value=t.toString(),f(S,p,0),f(l,m,1),f(o,b,2),f(d,E,3),f(c,T,4),f(u,y,5)}))},this.getUserAccount=()=>{return i=this,e=function*(){const i=window.location.search,n=new URLSearchParams(i),e=n.get("username"),g=yield fetch("https://guitar-tablature-to-pdf-147ddb720da0.herokuapp.com/getUserAccount?username="+e),r=yield g.json(),h=n.get("title");this.tabTitle=h,this.user=r;const s=this.user.tabs.find((t=>t.tabTitle===h));t.tab=this.splitTabIntoChunks(this.formatTabForPDFExport(s.tabData)),t.tabChunks=this.splitTabIntoChunks(this.formatTabForPDFExport(s.tabData)),this.initVideoUpload()},new((n=void 0)||(n=Promise))((function(t,g){function r(t){try{s(e.next(t))}catch(t){g(t)}}function h(t){try{s(e.throw(t))}catch(t){g(t)}}function s(i){var e;i.done?t(i.value):(e=i.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,h)}s((e=e.apply(i,[])).next())}));var i,n,e},this.splitTabIntoChunks=t=>{const i=t.highEString.split(""),n=t.bString.split(""),e=t.gString.split(""),g=t.dString.split(""),r=t.aString.split(""),h=t.eString.split(""),s=[],a=[],S=[],l=[],o=[],d=[],c={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};let u=33,p=this.TIMER;for(let t=0;t<i.length;t++)s.push(i[t]),a.push(n[t]),S.push(e[t]),l.push(g[t]),o.push(r[t]),d.push(h[t]),t!==u&&t!==i.length-1||(c.highEString.push({text:s.join(""),time:{start:p,end:p+this.TIMER}}),c.bString.push({text:a.join(""),time:{start:p,end:p+this.TIMER}}),c.gString.push({text:S.join(""),time:{start:p,end:p+this.TIMER}}),c.dString.push({text:l.join(""),time:{start:p,end:p+this.TIMER}}),c.aString.push({text:o.join(""),time:{start:p,end:p+this.TIMER}}),c.eString.push({text:d.join(""),time:{start:p,end:p+this.TIMER}}),u+=33,p+=this.TIMER,s.splice(0,t),a.splice(0,t),S.splice(0,t),l.splice(0,t),o.splice(0,t),d.splice(0,t));return c},this.formatTabForPDFExport=t=>{const i=this.findLongestString(t),n={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};let e,g,r,h,s,a;"string"==typeof t.highEString?(e=t.highEString.split(""),g=t.bString.split(""),r=t.gString.split(""),h=t.dString.split(""),s=t.aString.split(""),a=t.eString.split("")):(e=t.highEString,g=t.bString,r=t.gString,h=t.dString,s=t.aString,a=t.eString);const S=Math.max(e.length,g.length,r.length,h.length,s.length,a.length);for(let i=0;i<S;i++)void 0===t.highEString[i]&&(t.highEString+="-"),void 0===t.bString[i]&&(t.bString+="-"),void 0===t.gString[i]&&(t.gString+="-"),void 0===t.dString[i]&&(t.dString+="-"),void 0===t.aString[i]&&(t.aString+="-"),void 0===t.eString[i]&&(t.eString+="-");for(let e=0;e<i;e++){const i=t.highEString[e],g=t.bString[e],r=t.gString[e],h=t.dString[e],s=t.aString[e],a=t.eString[e],S=t.highEString[e-1],l=t.bString[e-1],o=t.gString[e-1],d=t.dString[e-1],c=t.aString[e-1],u=t.eString[e-1],p=t.highEString[e+1],m=t.bString[e+1],b=t.gString[e+1],E=t.dString[e+1],T=t.aString[e+1],y=t.eString[e+1];"{"!==i&&(n.highEString.push(i),"{"!==S&&"}"!==p&&"}"!==i&&n.highEString.push("-")),"{"!==g&&(n.bString.push(g),"{"!==l&&"}"!==m&&"}"!==g&&n.bString.push("-")),"{"!==r&&(n.gString.push(r),"{"!==o&&"}"!==b&&"}"!==r&&n.gString.push("-")),"{"!==h&&(n.dString.push(h),"{"!==d&&"}"!==E&&"}"!==h&&n.dString.push("-")),"{"!==s&&(n.aString.push(s),"{"!==c&&"}"!==T&&"}"!==s&&n.aString.push("-")),"{"!==a&&(n.eString.push(a),"{"!==u&&"}"!==y&&"}"!==a&&n.eString.push("-"))}const l=n.highEString.join("").split(""),o=n.bString.join("").split(""),d=n.gString.join("").split(""),c=n.dString.join("").split(""),u=n.aString.join("").split(""),p=n.eString.join("").split(""),m=Math.max(l.length,o.length,d.length,c.length,u.length,p.length);let b={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};for(let t=0;t<m;t++)b.highEString.push(n.highEString[t]||"-"),b.bString.push(n.bString[t]||"-"),b.gString.push(n.gString[t]||"-"),b.dString.push(n.dString[t]||"-"),b.aString.push(n.aString[t]||"-"),b.eString.push(n.eString[t]||"-");b={highEString:b.highEString,bString:b.bString,gString:b.gString,dString:b.dString,aString:b.aString,eString:b.eString};let E=0;for(let t=0;t<b.highEString.length;t++){const i=b.highEString[t]||"-",n=b.bString[t]||"-",e=b.gString[t]||"-",g=b.dString[t]||"-",r=b.aString[t]||"-",h=b.eString[t]||"-";"-"===i&&"-"===n&&"-"===e&&"-"===g&&"-"===r&&"-"===h||(E=t),"}"===i&&(b.highEString[t]="-"),"}"===n&&(b.bString[t]="-"),"}"===e&&(b.gString[t]="-"),"}"===g&&(b.dString[t]="-"),"}"===r&&(b.aString[t]="-"),"}"===h&&(b.eString[t]="-"),"}"!==i&&"}"!==n&&"}"!==e&&"}"!==g&&"}"!==r&&"}"!==h||("}"===i?b.highEString[t]="-":b.highEString.splice(t,0,"-"),"}"===n?b.bString[t]="-":b.bString.splice(t,0,"-"),"}"===e?b.gString[t]="-":b.gString.splice(t,0,"-"),"}"===g?b.dString[t]="-":b.dString.splice(t,0,"-"),"}"===r?b.aString[t]="-":b.aString.splice(t,0,"-"),"}"===h?b.eString[t]="-":b.eString.splice(t,0,"-"))}const T={highEString:b.highEString.slice(0,E+4).join(""),bString:b.bString.slice(0,E+4).join(""),gString:b.gString.slice(0,E+4).join(""),dString:b.dString.slice(0,E+4).join(""),aString:b.aString.slice(0,E+4).join(""),eString:b.eString.slice(0,E+4).join("")},y=document.getElementById("tab-text-highEString"),x=document.getElementById("tab-text-bString"),f=document.getElementById("tab-text-gString"),v=document.getElementById("tab-text-dString"),L=document.getElementById("tab-text-aString"),M=document.getElementById("tab-text-eString");return y.innerHTML=b.highEString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),x.innerHTML=b.bString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),f.innerHTML=b.gString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),v.innerHTML=b.dString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),L.innerHTML=b.aString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),M.innerHTML=b.eString.slice(0,Math.min(b.highEString.length,b.bString.length,b.gString.length,b.dString.length,b.aString.length,b.eString.length)).join(""),T},this.findLongestString=t=>{const i={stringName:"",stringLength:0};return Object.entries(t).forEach((t=>{const n=t[0],e=t[1].length;e>i.stringLength&&(i.stringName=n,i.stringLength=e)})),i.stringLength},this.user={},this.tabTitle=""}}(new t).init()})();