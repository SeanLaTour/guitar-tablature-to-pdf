(()=>{"use strict";(new class{constructor(){this.init=()=>{this.getUserAccount(),this.initVideoUpload()},this.initVideoUpload=()=>{const t=document.getElementById("video-upload"),n=document.getElementById("video-canvas"),i=n.getContext("2d"),e=document.getElementById("save-video");let g,r=document.createElement("video"),h=[];function S(){const t=document.getElementById("tab-text-highEString"),e=document.getElementById("tab-text-bString"),g=document.getElementById("tab-text-gString"),h=document.getElementById("tab-text-dString"),l=document.getElementById("tab-text-aString"),o=document.getElementById("tab-text-eString");r.paused||r.ended||(i.drawImage(r,0,0,n.width,n.height),i.font="48px Monospace",i.fillStyle="white",i.strokeStyle="white",i.lineWidth=2,i.textAlign="left",i.fillText(t.innerHTML,50,n.height-300),i.strokeText(t.innerHTML,50,n.height-300),i.fillText(e.innerHTML,50,n.height-250),i.strokeText(e.innerHTML,50,n.height-250),i.fillText(g.innerHTML,50,n.height-200),i.strokeText(g.innerHTML,50,n.height-200),i.fillText(h.innerHTML,50,n.height-150),i.strokeText(h.innerHTML,50,n.height-150),i.fillText(l.innerHTML,50,n.height-100),i.strokeText(l.innerHTML,50,n.height-100),i.fillText(o.innerHTML,50,n.height-50),i.strokeText(o.innerHTML,50,n.height-50),requestAnimationFrame(S))}function l(){const t=new Blob(h,{type:"video/webm"}),n=URL.createObjectURL(t),i=document.createElement("a");i.style.display="none",i.href=n,i.download="edited-video.webm",document.body.appendChild(i),i.click(),URL.revokeObjectURL(n)}t.addEventListener("change",(t=>{var i;const e=null===(i=t.target.files)||void 0===i?void 0:i[0];if(!e)return;document.getElementById("upload-video-buttons-container").style.display="none";const o=URL.createObjectURL(e);r.src=o,r.load(),r.play(),r.addEventListener("loadedmetadata",(()=>{n.width=r.videoWidth,n.height=r.videoHeight})),r.addEventListener("play",(()=>{const t=n.captureStream(30);g=new MediaRecorder(t,{mimeType:"video/webm; codecs=vp9"}),g.ondataavailable=t=>{t.data.size>0&&h.push(t.data)},g.onstop=l,g.start(),S()}))})),e.addEventListener("click",(()=>{g.stop()}))},this.getUserAccount=()=>{return t=this,i=function*(){const t=window.location.search,n=new URLSearchParams(t),i=n.get("username"),e=yield fetch("https://guitar-tablature-to-pdf-147ddb720da0.herokuapp.com/getUserAccount?username="+i),g=yield e.json(),r=n.get("title");this.tabTitle=r,this.user=g;const h=this.user.tabs.find((t=>t.tabTitle===r));this.tab=h.tabData,this.formatTabForPDFExport(h.tabData)},new((n=void 0)||(n=Promise))((function(e,g){function r(t){try{S(i.next(t))}catch(t){g(t)}}function h(t){try{S(i.throw(t))}catch(t){g(t)}}function S(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(t){t(i)}))).then(r,h)}S((i=i.apply(t,[])).next())}));var t,n,i},this.formatTabForPDFExport=t=>{const n=this.findLongestString(t),i={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};let e,g,r,h,S,l;"string"==typeof t.highEString?(e=t.highEString.split(""),g=t.bString.split(""),r=t.gString.split(""),h=t.dString.split(""),S=t.aString.split(""),l=t.eString.split("")):(e=t.highEString,g=t.bString,r=t.gString,h=t.dString,S=t.aString,l=t.eString);const o=Math.max(e.length,g.length,r.length,h.length,S.length,l.length);for(let n=0;n<o;n++)void 0===t.highEString[n]&&(t.highEString+="-"),void 0===t.bString[n]&&(t.bString+="-"),void 0===t.gString[n]&&(t.gString+="-"),void 0===t.dString[n]&&(t.dString+="-"),void 0===t.aString[n]&&(t.aString+="-"),void 0===t.eString[n]&&(t.eString+="-");for(let e=0;e<n;e++){const n=t.highEString[e],g=t.bString[e],r=t.gString[e],h=t.dString[e],S=t.aString[e],l=t.eString[e],o=t.highEString[e-1],a=t.bString[e-1],s=t.gString[e-1],d=t.dString[e-1],c=t.aString[e-1],u=t.eString[e-1],b=t.highEString[e+1],p=t.bString[e+1],m=t.gString[e+1],E=t.dString[e+1],T=t.aString[e+1],L=t.eString[e+1];"{"!==n&&(i.highEString.push(n),"{"!==o&&"}"!==b&&"}"!==n&&i.highEString.push("-")),"{"!==g&&(i.bString.push(g),"{"!==a&&"}"!==p&&"}"!==g&&i.bString.push("-")),"{"!==r&&(i.gString.push(r),"{"!==s&&"}"!==m&&"}"!==r&&i.gString.push("-")),"{"!==h&&(i.dString.push(h),"{"!==d&&"}"!==E&&"}"!==h&&i.dString.push("-")),"{"!==S&&(i.aString.push(S),"{"!==c&&"}"!==T&&"}"!==S&&i.aString.push("-")),"{"!==l&&(i.eString.push(l),"{"!==u&&"}"!==L&&"}"!==l&&i.eString.push("-"))}const a=i.highEString.join("").split(""),s=i.bString.join("").split(""),d=i.gString.join("").split(""),c=i.dString.join("").split(""),u=i.aString.join("").split(""),b=i.eString.join("").split(""),p=Math.max(a.length,s.length,d.length,c.length,u.length,b.length);let m={highEString:[],bString:[],gString:[],dString:[],aString:[],eString:[]};for(let t=0;t<p;t++)m.highEString.push(i.highEString[t]||"-"),m.bString.push(i.bString[t]||"-"),m.gString.push(i.gString[t]||"-"),m.dString.push(i.dString[t]||"-"),m.aString.push(i.aString[t]||"-"),m.eString.push(i.eString[t]||"-");m={highEString:m.highEString,bString:m.bString,gString:m.gString,dString:m.dString,aString:m.aString,eString:m.eString};let E=0;for(let t=0;t<m.highEString.length;t++){const n=m.highEString[t]||"-",i=m.bString[t]||"-",e=m.gString[t]||"-",g=m.dString[t]||"-",r=m.aString[t]||"-",h=m.eString[t]||"-";"-"===n&&"-"===i&&"-"===e&&"-"===g&&"-"===r&&"-"===h||(E=t),"}"===n&&(m.highEString[t]="-"),"}"===i&&(m.bString[t]="-"),"}"===e&&(m.gString[t]="-"),"}"===g&&(m.dString[t]="-"),"}"===r&&(m.aString[t]="-"),"}"===h&&(m.eString[t]="-"),"}"!==n&&"}"!==i&&"}"!==e&&"}"!==g&&"}"!==r&&"}"!==h||("}"===n?m.highEString[t]="-":m.highEString.splice(t,0,"-"),"}"===i?m.bString[t]="-":m.bString.splice(t,0,"-"),"}"===e?m.gString[t]="-":m.gString.splice(t,0,"-"),"}"===g?m.dString[t]="-":m.dString.splice(t,0,"-"),"}"===r?m.aString[t]="-":m.aString.splice(t,0,"-"),"}"===h?m.eString[t]="-":m.eString.splice(t,0,"-"))}const T={highEString:m.highEString.slice(0,E+4).join(""),bString:m.bString.slice(0,E+4).join(""),gString:m.gString.slice(0,E+4).join(""),dString:m.dString.slice(0,E+4).join(""),aString:m.aString.slice(0,E+4).join(""),eString:m.eString.slice(0,E+4).join("")},L=document.getElementById("tab-text-highEString"),f=document.getElementById("tab-text-bString"),v=document.getElementById("tab-text-gString"),x=document.getElementById("tab-text-dString"),y=document.getElementById("tab-text-aString"),M=document.getElementById("tab-text-eString");return L.innerHTML=m.highEString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),f.innerHTML=m.bString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),v.innerHTML=m.gString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),x.innerHTML=m.dString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),y.innerHTML=m.aString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),M.innerHTML=m.eString.slice(0,Math.min(m.highEString.length,m.bString.length,m.gString.length,m.dString.length,m.aString.length,m.eString.length)).join(""),T},this.findLongestString=t=>{const n={stringName:"",stringLength:0};return Object.entries(t).forEach((t=>{const i=t[0],e=t[1].length;e>n.stringLength&&(n.stringName=i,n.stringLength=e)})),n.stringLength},this.user={},this.tabTitle="",this.tab={}}}).init()})();